/*
 * Copyright OpenSearch Contributors
 * SPDX-License-Identifier: Apache-2.0
 */

const fs = require('fs');

const lines = fs
  .readFileSync(`${__dirname}/../${process.argv[2] || 'ppl'}.jsonl`, 'utf8')
  .split(/\r?\n/)
  .filter((line) => line.trim() !== '')
  .map((line) => JSON.parse(line));

let exact = 0,
  close = 0,
  runnable = 0,
  total = 0,
  exceptions = {};
lines.map((line) => {
  total += 1;
  if (line.score === 1) {
    exact += 1;
    close += 1;
  } else if (line.score >= 0.8) {
    close += 1;
  }
  if (line.exception === null) {
    runnable += 1;
  } else {
    exceptions[line.exception] = 1 + (exceptions[line.exception] ?? 0);
  }
});

const percent = (num) => num + ' (' + Math.round((num / total) * 100 * 100) / 100 + '%)';

console.info('❗exact:', percent(exact));
console.info('❗close:', percent(close));
console.info('❗runnable:', percent(runnable));
console.info('❗total:', percent(total));
console.info('❗exceptions:', exceptions);
